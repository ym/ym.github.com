<!doctype html>
<html class="theme-next  theme-next-mist">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>


<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.3"/>




  <meta name="keywords" content="Hexo,next" />



  <link rel="alternate" href="/atom.xml" title="Aveline's Blog" type="application/atom+xml" />



  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.3" />



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    analytics: {
      google: 'UA-20336289-2'
    },
    sidebar: 'post'
  };
</script>




  <title> Aveline's Blog </title>
</head>

<body>
  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->

  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <div id="header" class="header">
      <div class="header-inner">
        <h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand">
      <span class="logo">
        <i class="icon-logo"></i>
      </span>
      <span class="site-title">Aveline's Blog</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<div class="site-nav">
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-home">
          <a href="/">
            <i class="menu-item-icon icon-home"></i> <br />
            首頁
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            <i class="menu-item-icon icon-archives"></i> <br />
            歸檔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            <i class="menu-item-icon icon-tags"></i> <br />
            標籤
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
<form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
</form>
<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'h7fLV84amzbZPuPcVWP6','2.0.0');
</script>

<div class="site-search-toggle"></div>
    </div>
  
</div>


      </div>
    </div>

    <div id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <div id="posts" class="posts-expand">
    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/zai-debian-shang-shi-yong-cloudfuse-rsync-tong-bu-ben-di-wen-jian-dao-rackspace-cloud-files/">
                '在 Debian 上使用 CloudFUSE + Rsync 同步本地文件到 Rackspace Cloud Files'
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          發表於 2013-03-22
        </span>

        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/zai-debian-shang-shi-yong-cloudfuse-rsync-tong-bu-ben-di-wen-jian-dao-rackspace-cloud-files/#comments" >
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="zai-debian-shang-shi-yong-cloudfuse-rsync-tong-bu-ben-di-wen-jian-dao-rackspace-cloud-files/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <p>Showfom 这个 MJJ 的昨天说要把自己的图片同步到 Rackspace Cloud Files 去，让我写个小脚本来实现一下。</p>
<p>但是，作为一个 MJJ 的。。。能偷懒的，当然要偷懒！没事儿自己挖什么坑呢真是的，填不平又有强迫症。</p>
<p>不扯淡了，先安装一下依赖：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install -y build-essential fuse-utils libfuse-dev libcurl3-dev libxml2-dev libssl-dev</span><br></pre></td></tr></table></figure>
<p>然后下载 CloudFUSE，编译，安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget http://github.com/redbo/cloudfuse/tarball/master</span><br><span class="line">tar zxf master</span><br><span class="line"><span class="built_in">cd</span> redbo-cloudfuse-<span class="number">809</span>b07e</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>编译的时候可能会提示</p>
<blockquote>
<p>cloudfsapi.c: In function ‘send_request’:</p>
<p>cloudfsapi.c:140: warning: call to ‘_curl_easy_setopt_err_long’ declared with attribute warning: curl_easy_setopt expects a long argument for this option</p>
</blockquote>
<p>看了下代码，这里用的是 off_t，不过其实 off_t 就是 long 的马甲啦 [1]，所以这段 Warning 不用管，直接继续就好。</p>
<p>接下来在 ~/.cloudfuse 写下配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username=[Account username]</span><br><span class="line">api_key=[API key (or password <span class="keyword">for</span> Keystone API)]</span><br></pre></td></tr></table></figure>
<p>当然你也可以用偷懒的办法不写配置文件直接挂载</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cloudfuse -o username=aveline,api_key=<span class="number">123123123</span> /mnt</span><br></pre></td></tr></table></figure>
<p>或者是写在 <strong>/etc/fstab</strong> 里</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cloudfuse /mnt fuse username=aveline,api_key=123123123,user 0 0</span><br></pre></td></tr></table></figure>
<p>然后，挂载~同步</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cloudfuse /mnt</span><br><span class="line">rsync -av ~/dropbox /mnt/<span class="built_in">test</span>/</span><br></pre></td></tr></table></figure>
<p>大功告成咯~</p>
<p>[1] <a href="http://stackoverflow.com/questions/9073667/where-to-find-the-complete-definition-of-off-t-type" title="Where to find the complete definition of off_t type? - Stack Overflow" target="_blank" rel="external">Where to find the complete definition of off_t type? &#8211; Stack Overflow</a></p>

        
      
    </div>

    <div class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/jie-jue-web-fonts-zai-firefox-xia-bu-jia-zai-de-wen-ti/">
                '解决 Web fonts 在 Firefox 下不加载的问题'
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          發表於 2013-03-20
        </span>

        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/jie-jue-web-fonts-zai-firefox-xia-bu-jia-zai-de-wen-ti/#comments" >
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="jie-jue-web-fonts-zai-firefox-xia-bu-jia-zai-de-wen-ti/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <p>今天给大叔的 Eureka 换新首页，换完之后大叔表示在 Firefox 下 Webfont 不加载。</p>
<p>开始觉得肯定是 MIME Types 的问题。。。于是，去 Rackspace Cloud Files 里把 Content-Type 修正了一下。</p>
<p>修正之后还是不正常，开 Google 搜索了下。</p>
<p>然后发现 Firefox 是不考虑 Webfonts 的 Content-Type 的：</p>
<blockquote>
<p>Note: Because there are no defined MIME types for TrueType, OpenType, and Web Open File Format (WOFF) fonts, the MIME type of the file specified is not considered.</p>
</blockquote>
<p>问题出在这里：</p>
<blockquote>
<p>In Gecko, web fonts are subject to the same domain restriction (font files must be on the same domain as the page using them), unless HTTP access controls are used to relax this restriction.</p>
</blockquote>
<p>如果 Web fonts 不是与发起请求的页面在一个域下，那么除非 HTTP access control 允许了，否则这个字体文件是不会被载入的。</p>
<p>嗯，知道问题在哪儿就简单了，去加个 Custom-Header：</p>
<p><code>Access-Control-Allow-Origin: https://xxooxxoo.xxx</code></p>
<p>然后刷新下 CDN 即可。。。</p>
<p>火狐，就你事儿多。。。</p>
<p>参考:</p>
<p>[1] <a href="https://developer.mozilla.org/en-US/docs/CSS/@font-face" target="_blank" rel="external">@font-face &#8211; Mozilla Developer Network </a></p>

        
      
    </div>

    <div class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/zai-nodejs-shang-jie-xi-pydict/">
                '在 NodeJS 上解析 PyDict'
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          發表於 2013-03-11
        </span>

        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/zai-nodejs-shang-jie-xi-pydict/#comments" >
              <span class="post-comments-count disqus-comment-count" data-disqus-identifier="zai-nodejs-shang-jie-xi-pydict/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <p>一般情况下呢，PyDict 长得确实是挺像 JSON 的。</p>
<p>比如这种：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">'foo'</span>: <span class="string">'bar'</span>&#125;</span><br></pre></td></tr></table></figure>
<p>把单引号全换成双引号就可以解析了，这样子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.parse(<span class="string">"&#123;'foo': 'bar'&#125;;"</span>.replace(<span class="regexp">/\'/g</span>, <span class="string">'"'</span>))</span><br></pre></td></tr></table></figure>
<p>但是，要是遇到带 Unicode 的，比如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">'\\xe9\\x94\\x99\\xe8\\xaf\\xaf'</span>: <span class="string">'\\xe4\\xbd\\xa0\\xe4\\xbb\\xac\\xe5\\x86\\x8d\\xe8\\xaf\\xb4 Python Dict \\xe5\\xb0\\xb1\\xe6\\x98\\xaf JSON \\xe6\\x88\\x91\\xe5\\xb0\\xb1\\xe6\\x97\\xa5\\xe6\\xad\\xbb\\xe4\\xbd\\xa0\\xef\\xbc\\x81\\xe5\\x93\\xbc\\xef\\xbc\\x81'</span>&#125;</span><br></pre></td></tr></table></figure>
<p>就木有办法了，也许有人说。。。有！我把 <strong>\xb1</strong> 什么的自己处理掉！</p>
<p>好吧这是一种办法，但是我用了更蛋疼的方法，直接用 C艹 写了个库，把 PyDict 用 Python 转成 JSON 然后 JSON.parse 之。。。</p>
<p>由于学艺不精，写这个库的时候 Segment fault 数次，还曾有各种内存泄露。</p>
<p>嗯，不过总算是写完了。</p>
<p>Github 地址在这里: <a href="https://github.com/ym/node-pydict" target="_blank" rel="external">https://github.com/ym/node-pydict</a></p>
<p>要用的话直接 <code>npm install pydict</code> 就可以安装了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pydict = <span class="built_in">require</span>(<span class="string">'pydict'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(pydict.parse(<span class="string">"&#123;'\\xe9\\x94\\x99\\xe8\\xaf\\xaf': '\\xe4\\xbd\\xa0\\xe4\\xbb\\xac\\xe5\\x86\\x8d\\xe8\\xaf\\xb4 Python Dict \\xe5\\xb0\\xb1\\xe6\\x98\\xaf JSON \\xe6\\x88\\x91\\xe5\\xb0\\xb1\\xe6\\x97\\xa5\\xe6\\xad\\xbb\\xe4\\xbd\\xa0\\xef\\xbc\\x81\\xe5\\x93\\xbc\\xef\\xbc\\x81'&#125;"</span>));</span><br></pre></td></tr></table></figure>
<p>PS: 虽然我吐槽了很多次但是我还是要再吐槽一遍！！！研发的亲们！！！你们能不能不要再告诉我 PyDict 就是 JSON 了啊啊啊！！！</p>
<p>再 PS: 困死我了居然还睡不了因为今天是 Deadline &#8230; 哼哼哼下次再乱改需求就不干了！！！</p>
<p><strong>由于在我的生产环境中又 Segfault 了 &#8230; 于是我用了一种 <del datetime="2013-03-12T07:50:32+00:00">很黄很暴力</del> 的方法</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pydict = <span class="function"><span class="keyword">function</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">	<span class="comment">/* drop all unicode string */</span></span><br><span class="line">	str = str.replace(<span class="regexp">/(\\x[0-9a-f]&#123;2&#125;)/g</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="string">''</span> &#125;).replace(<span class="regexp">/\'/g</span>, <span class="string">'"'</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		str = <span class="built_in">JSON</span>.parse(str);</span><br><span class="line">	&#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>嗯&#8230; 反正我也不用那堆中文&#8230;</strong></p>

        
      
    </div>

    <div class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
  </div>

  
  <div class="pagination">
    <a class="extend prev" rel="prev" href="/page/9/">&laquo;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/11/">&raquo;</a>
  </div>


        </div>

        
      </div>


      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <div id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      <div class="site-overview">
        <div class="site-author motion-element">
          <img class="site-author-image" src="https://en.gravatar.com/userimage/15516490/ccf4829ea2de640a573974d1e17698ee.png?size=360" alt="Aveline Swan" />
          <p class="site-author-name">Aveline Swan</p>
        </div>
        <p class="site-description motion-element"></p>
        <div class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">33</span>
              <span class="site-state-item-name">文章</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">分類</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">23</span>
              <span class="site-state-item-name">標籤</span>
              </a>
          </div>

        </div>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml">
              <i class="menu-item-icon icon-feed"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
              <a href="https://github.com/ym" target="_blank">GitHub</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="https://twitter.com/Aveline_Swan" target="_blank">Twitter</a>
            </span>
            
              <span class="links-of-author-item">
              <a href="http://www.douban.com/people/avelineswan/" target="_blank">DouBan</a>
            </span>
            
          
        </div>

        
        

      </div>

      

    </div>
  </div>


    </div>

    <div id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; &nbsp;  2005 - 
  2016
  <span class="with-love">
    <i class="icon-heart"></i>
  </span>
  <span class="author">Aveline Swan</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 強力驅動
</div>

<div class="theme-info">
  主題 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </div>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.3"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.3"></script>
  

  <script type="text/javascript" src="/js/motion_fallback.js?v=0.4.3" id="motion.fallback"></script>



  <script type="text/javascript" src="/js/search-toggle.js"></script>

  

  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
    });
  </script>

  

  
  
  

  

    
      
    

    <script type="text/javascript">
      var disqus_shortname = 'av2b';
      var disqus_identifier = 'page/10/index.html';
      var disqus_title = '';
      var disqus_url = '';

      (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }());
    </script>
  




  
  
  <script type="text/javascript" src="/js/analytics_google-analytics.js?v=0.4.3"></script>


</body>
</html>
